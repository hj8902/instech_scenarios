<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>instech 시나리오 테스트 목록</title>
<style>
  :root {
    --primary: #2563eb;
    --primary-bg: #eff6ff;
    --setup: #8b5cf6;
    --setup-bg: #f5f3ff;
    --test: #059669;
    --test-bg: #ecfdf5;
    --happy: #059669;
    --happy-bg: #ecfdf5;
    --edge: #d97706;
    --edge-bg: #fffbeb;
    --border: #e5e7eb;
    --text: #1f2937;
    --text-light: #6b7280;
    --text-lighter: #9ca3af;
    --bg: #f9fafb;
    --white: #ffffff;
    --sidebar-w: 260px;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
  }

  /* ── Layout ── */
  .layout {
    display: flex;
    height: 100vh;
  }

  /* ── Sidebar ── */
  .sidebar {
    width: var(--sidebar-w);
    min-width: var(--sidebar-w);
    background: var(--white);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .sidebar-header {
    padding: 20px 16px 12px;
    border-bottom: 1px solid var(--border);
  }
  .sidebar-header h1 {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 2px;
  }
  .sidebar-meta {
    display: flex;
    gap: 10px;
    font-size: 11px;
    color: var(--text-lighter);
    margin-top: 6px;
  }
  .sidebar-nav {
    flex: 1;
    overflow-y: auto;
    padding: 8px 0;
  }

  /* Nav items */
  .nav-group {
    margin-bottom: 2px;
  }
  .nav-feature {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    cursor: pointer;
    user-select: none;
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    transition: background 0.1s;
    border-left: 3px solid transparent;
  }
  .nav-feature:hover {
    background: var(--bg);
  }
  .nav-feature.active {
    background: var(--primary-bg);
    border-left-color: var(--primary);
    color: var(--primary);
  }
  .nav-arrow {
    font-size: 9px;
    color: var(--text-lighter);
    transition: transform 0.2s;
    width: 12px;
    text-align: center;
    flex-shrink: 0;
  }
  .nav-group.open > .nav-feature .nav-arrow {
    transform: rotate(90deg);
  }
  .nav-feature .nav-icon {
    font-size: 14px;
    flex-shrink: 0;
    width: 18px;
    text-align: center;
  }
  .nav-feature-label { flex: 1; }
  .nav-count {
    font-size: 11px;
    font-weight: 500;
    color: var(--text-lighter);
    background: var(--bg);
    padding: 1px 7px;
    border-radius: 999px;
    flex-shrink: 0;
  }
  .nav-feature.active .nav-count {
    background: rgba(37, 99, 235, 0.1);
    color: var(--primary);
  }

  .nav-children {
    display: none;
  }
  .nav-group.open > .nav-children {
    display: block;
  }
  .nav-cat {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 16px 6px 40px;
    cursor: pointer;
    user-select: none;
    font-size: 12px;
    color: var(--text-light);
    transition: background 0.1s;
    border-left: 3px solid transparent;
  }
  .nav-cat:hover {
    background: var(--bg);
  }
  .nav-cat.active {
    background: var(--primary-bg);
    border-left-color: var(--primary);
    color: var(--primary);
    font-weight: 600;
  }
  .nav-cat-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .nav-cat-dot.happy { background: var(--happy); }
  .nav-cat-dot.edge { background: var(--edge); }
  .nav-cat-label { flex: 1; }
  .nav-cat-count {
    font-size: 11px;
    color: var(--text-lighter);
    flex-shrink: 0;
  }
  .nav-cat.active .nav-cat-count {
    color: var(--primary);
  }

  /* ── Content ── */
  .content {
    flex: 1;
    overflow-y: auto;
    padding: 24px 32px;
    min-width: 0;
  }

  /* Content header */
  .content-header {
    margin-bottom: 20px;
  }
  .content-breadcrumb {
    font-size: 12px;
    color: var(--text-lighter);
    margin-bottom: 4px;
  }
  .content-title {
    font-size: 20px;
    font-weight: 700;
  }
  .content-count {
    font-size: 13px;
    color: var(--text-lighter);
    margin-top: 2px;
  }

  /* ── Scenario Card ── */
  .card {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 8px;
    overflow: hidden;
    transition: box-shadow 0.15s;
  }
  .card:hover {
    box-shadow: 0 1px 6px rgba(0,0,0,0.05);
  }
  .card-header {
    padding: 12px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    user-select: none;
  }
  .card-header:hover {
    background: var(--bg);
  }
  .card-arrow {
    font-size: 10px;
    color: var(--text-lighter);
    transition: transform 0.2s;
    flex-shrink: 0;
    width: 14px;
    text-align: center;
  }
  .card.open .card-arrow {
    transform: rotate(90deg);
  }
  .badge {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 10px;
    font-weight: 600;
    flex-shrink: 0;
    white-space: nowrap;
  }
  .badge.setup { background: var(--setup-bg); color: var(--setup); }
  .badge.test { background: var(--test-bg); color: var(--test); }
  .badge.auth { background: #fef3c7; color: #92400e; }
  .badge.happy { background: var(--happy-bg); color: var(--happy); }
  .badge.edge { background: var(--edge-bg); color: var(--edge); }

  .card-title {
    font-size: 14px;
    font-weight: 600;
    flex: 1;
  }
  .card-step-count {
    font-size: 12px;
    color: var(--text-lighter);
    flex-shrink: 0;
  }

  /* Card Body */
  .card-body {
    display: none;
    border-top: 1px solid var(--border);
    padding: 14px 16px;
  }
  .card.open .card-body {
    display: block;
  }
  .card-desc {
    font-size: 13px;
    color: var(--text-light);
    margin-bottom: 14px;
    line-height: 1.7;
  }

  /* Steps */
  .steps-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-lighter);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
  }
  .step-list {
    list-style: none;
    position: relative;
  }
  .step-list::before {
    content: '';
    position: absolute;
    left: 11px;
    top: 14px;
    bottom: 14px;
    width: 2px;
    background: var(--border);
  }
  .step-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 5px 0;
    position: relative;
  }
  .step-dot {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--white);
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 600;
    color: var(--text-light);
    flex-shrink: 0;
    z-index: 1;
  }
  .step-item.action .step-dot { border-color: var(--primary); color: var(--primary); background: var(--primary-bg); }
  .step-item.check .step-dot { border-color: var(--test); color: var(--test); background: var(--test-bg); }
  .step-item.screenshot .step-dot { border-color: var(--text-lighter); color: var(--text-lighter); }
  .step-item.manual .step-dot { border-color: #f59e0b; color: #f59e0b; background: #fffbeb; }

  .step-content {
    flex: 1;
    padding-top: 2px;
  }
  .step-desc {
    font-size: 13px;
  }
  .step-action-tag {
    display: inline-block;
    font-size: 10px;
    font-weight: 600;
    padding: 1px 6px;
    border-radius: 4px;
    margin-right: 4px;
    vertical-align: middle;
  }
  .step-action-tag.navigate { background: #dbeafe; color: #1e40af; }
  .step-action-tag.fill { background: #fce7f3; color: #9d174d; }
  .step-action-tag.click { background: #e0e7ff; color: #3730a3; }
  .step-action-tag.blur { background: #fef3c7; color: #92400e; }
  .step-action-tag.expect { background: #d1fae5; color: #065f46; }
  .step-action-tag.screenshot { background: #f3f4f6; color: #6b7280; }
  .step-action-tag.wait { background: #fef9c3; color: #854d0e; }
  .step-action-tag.manual { background: #fff7ed; color: #c2410c; }
  .step-action-tag.terms { background: #ede9fe; color: #6d28d9; }
  .step-action-tag.state { background: #f0fdf4; color: #166534; }
  .step-action-tag.store { background: #fdf2f8; color: #9d174d; }

  /* Variables */
  .variables {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #f3f4f6;
  }
  .variables-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-lighter);
    margin-bottom: 4px;
  }
  .var-chip {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-family: 'SF Mono', 'Fira Code', monospace;
    background: #f3f4f6;
    color: var(--text-light);
    margin-right: 4px;
    margin-bottom: 4px;
  }

  /* Precondition */
  .precondition {
    display: flex;
    align-items: flex-start;
    gap: 6px;
    padding: 8px 12px;
    margin-bottom: 10px;
    background: #fef3c7;
    border-radius: 8px;
    font-size: 12px;
    color: #92400e;
    line-height: 1.5;
  }
  .precondition-icon { flex-shrink: 0; font-size: 13px; }
  .precondition-label { font-weight: 600; margin-right: 4px; }

  /* Loading & Error */
  .loading {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-light);
  }
  .spinner {
    width: 32px;
    height: 32px;
    border: 3px solid var(--border);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 12px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .error {
    text-align: center;
    padding: 60px 20px;
    color: #ef4444;
  }

  /* Empty state */
  .empty {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-lighter);
    font-size: 14px;
  }

  /* Footer */
  .footer {
    padding: 16px;
    border-top: 1px solid var(--border);
    text-align: center;
    font-size: 11px;
    color: var(--text-lighter);
    flex-shrink: 0;
  }
</style>
</head>
<body>

<div class="layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1>instech 시나리오</h1>
      <div class="sidebar-meta">
        <span id="meta-version"></span>
        <span id="meta-count"></span>
      </div>
    </div>
    <nav class="sidebar-nav" id="sidebar-nav">
      <div class="loading">
        <div class="spinner"></div>
      </div>
    </nav>
    <div class="footer">
      Claude Code (instech-scenario-test skill)로 실행
    </div>
  </aside>

  <!-- Content -->
  <main class="content" id="content">
    <div class="empty">좌측 메뉴에서 시나리오를 선택하세요.</div>
  </main>
</div>

<script>
const BASE = 'https://hj8902.github.io/instech_scenarios/scenarios';

const FEATURE_LABELS = {
  '_setup': '사전설정',
  'age-calculation': '보험나이',
  'counsel': '보험상담',
};

const FEATURE_ICONS = {
  '_setup': '&#9881;',
  'age-calculation': '&#128197;',
  'counsel': '&#128172;',
};

const CATEGORY_LABELS = {
  happy: 'Happy Path',
  edge: 'EdgeCase Path',
};

const CATEGORY_ORDER = ['happy', 'edge'];

const ACTION_LABELS = {
  navigate: '이동', fill: '입력', click: '클릭', clear: '삭제',
  blur: '포커스해제', waitFor: '대기', waitForNavigation: '대기',
  waitForResponse: '대기', waitForTimeout: '대기', waitForUrl: '대기',
  expect: '검증', screenshot: '캡처', loadState: '상태로드',
  saveState: '상태저장', launchBrowser: '브라우저', manualAction: '수동',
  handleTermsAgreement: '약관동의', injectStoreData: '스토어주입',
  fetchAndInjectUserInfo: '유저정보주입', setSessionStorage: '세션저장',
};

const ACTION_TAG_CLASS = {
  navigate: 'navigate', fill: 'fill', click: 'click', clear: 'fill',
  blur: 'blur', waitFor: 'wait', waitForNavigation: 'wait',
  waitForResponse: 'wait', waitForTimeout: 'wait', waitForUrl: 'wait',
  expect: 'expect', screenshot: 'screenshot', loadState: 'state',
  saveState: 'state', launchBrowser: 'navigate', manualAction: 'manual',
  handleTermsAgreement: 'terms', injectStoreData: 'store',
  fetchAndInjectUserInfo: 'store', setSessionStorage: 'state',
};

const STEP_TYPE = {
  navigate: 'action', fill: 'action', click: 'action', clear: 'action',
  blur: 'action', expect: 'check', screenshot: 'screenshot',
  manualAction: 'manual', handleTermsAgreement: 'action',
  injectStoreData: 'action', fetchAndInjectUserInfo: 'action',
  setSessionStorage: 'action',
};

// ── State ──
let allScenarios = [];
let featureMap = {};  // folder -> scenarios[]

async function load() {
  const nav = document.getElementById('sidebar-nav');
  const content = document.getElementById('content');

  try {
    const indexRes = await fetch(`${BASE}/index.json`);
    if (!indexRes.ok) throw new Error('index.json 로드 실패');
    const index = await indexRes.json();

    document.getElementById('meta-version').textContent = `v${index.version}`;
    document.getElementById('meta-count').textContent = `${index.scenarios.length}개`;

    allScenarios = await Promise.all(
      index.scenarios.map(async (s) => {
        try {
          const res = await fetch(`${BASE}/${s.path}`);
          if (!res.ok) return { ...s, steps: [], _error: true };
          const detail = await res.json();
          return { ...s, ...detail };
        } catch {
          return { ...s, steps: [], _error: true };
        }
      })
    );

    // Group by folder
    featureMap = {};
    allScenarios.forEach(s => {
      const folder = s.path.split('/')[0] || '_etc';
      if (!featureMap[folder]) featureMap[folder] = [];
      featureMap[folder].push(s);
    });

    renderNav();

    // Select first item by default
    const firstNavItem = nav.querySelector('.nav-feature');
    if (firstNavItem) firstNavItem.click();

  } catch (e) {
    nav.innerHTML = '';
    content.innerHTML = `<div class="error"><p>로드 실패</p><p style="font-size:13px;margin-top:8px">${e.message}</p></div>`;
  }
}

function renderNav() {
  const nav = document.getElementById('sidebar-nav');
  let html = '';

  Object.entries(featureMap).forEach(([folder, scenarios]) => {
    const label = FEATURE_LABELS[folder] || folder;
    const icon = FEATURE_ICONS[folder] || '&#128196;';
    const total = scenarios.length;

    // Category breakdown
    const catGroups = {};
    scenarios.forEach(s => {
      const cat = s.category || (s.type === 'setup' ? null : 'happy');
      if (cat) {
        if (!catGroups[cat]) catGroups[cat] = [];
        catGroups[cat].push(s);
      }
    });

    const hasCats = Object.keys(catGroups).length > 0;
    const isSetup = folder === '_setup';

    html += `<div class="nav-group${hasCats && !isSetup ? ' open' : ''}" data-folder="${folder}">`;
    html += `
      <div class="nav-feature" data-folder="${folder}" data-cat="" onclick="onNavClick(this)">
        ${hasCats && !isSetup ? '<span class="nav-arrow">&#9654;</span>' : '<span style="width:12px"></span>'}
        <span class="nav-icon">${icon}</span>
        <span class="nav-feature-label">${label}</span>
        <span class="nav-count">${total}</span>
      </div>`;

    if (hasCats && !isSetup) {
      html += '<div class="nav-children">';
      CATEGORY_ORDER.forEach(cat => {
        if (!catGroups[cat]) return;
        html += `
          <div class="nav-cat" data-folder="${folder}" data-cat="${cat}" onclick="onNavClick(this)">
            <span class="nav-cat-dot ${cat}"></span>
            <span class="nav-cat-label">${CATEGORY_LABELS[cat]}</span>
            <span class="nav-cat-count">${catGroups[cat].length}</span>
          </div>`;
      });
      html += '</div>';
    }

    html += '</div>';
  });

  nav.innerHTML = html;

  // Toggle children on arrow click
  nav.querySelectorAll('.nav-feature').forEach(el => {
    el.addEventListener('click', (e) => {
      const group = el.closest('.nav-group');
      if (group.querySelector('.nav-children')) {
        group.classList.toggle('open');
      }
    });
  });
}

function onNavClick(el) {
  // Update active state
  document.querySelectorAll('.nav-feature, .nav-cat').forEach(n => n.classList.remove('active'));
  el.classList.add('active');

  const folder = el.dataset.folder;
  const cat = el.dataset.cat;

  let scenarios = featureMap[folder] || [];
  if (cat) {
    scenarios = scenarios.filter(s => (s.category || 'happy') === cat);
  }

  const featureLabel = FEATURE_LABELS[folder] || folder;
  const catLabel = cat ? CATEGORY_LABELS[cat] : '';
  const breadcrumb = cat ? `${featureLabel}` : '';
  const title = cat ? `${featureLabel} — ${catLabel}` : featureLabel;

  renderContent(scenarios, title, breadcrumb, cat);
}

function renderContent(scenarios, title, breadcrumb, filterCat) {
  const content = document.getElementById('content');

  let html = `
    <div class="content-header">
      ${breadcrumb ? `<div class="content-breadcrumb">${breadcrumb}</div>` : ''}
      <div class="content-title">${title}</div>
      <div class="content-count">${scenarios.length}개 시나리오</div>
    </div>`;

  if (scenarios.length === 0) {
    html += '<div class="empty">해당하는 시나리오가 없습니다.</div>';
  } else {
    // If showing all categories (no filter), group by category
    if (!filterCat) {
      const catGroups = {};
      scenarios.forEach(s => {
        const cat = s.category || (s.type === 'setup' ? 'setup' : 'happy');
        if (!catGroups[cat]) catGroups[cat] = [];
        catGroups[cat].push(s);
      });

      const order = s => s.type === 'setup' ? ['setup'] : CATEGORY_ORDER;
      const cats = Object.keys(catGroups).sort((a, b) => {
        const idx = ['setup', ...CATEGORY_ORDER];
        return idx.indexOf(a) - idx.indexOf(b);
      });

      cats.forEach(cat => {
        catGroups[cat].forEach(s => { html += renderCard(s, true); });
      });
    } else {
      scenarios.forEach(s => { html += renderCard(s, false); });
    }
  }

  content.innerHTML = html;

  // Card toggle handlers
  content.querySelectorAll('.card-header').forEach(h => {
    h.addEventListener('click', () => {
      h.parentElement.classList.toggle('open');
    });
  });
}

function renderCard(s, showCategoryBadge) {
  const typeBadge = s.type === 'setup'
    ? '<span class="badge setup">사전설정</span>'
    : '';
  const authBadge = s.requiresAuth ? '<span class="badge auth">로그인 필요</span>' : '';
  const catBadge = showCategoryBadge && s.category
    ? `<span class="badge ${s.category}">${CATEGORY_LABELS[s.category]}</span>`
    : '';
  const stepCount = s.steps ? s.steps.length : 0;

  let stepsHtml = '';
  if (s.steps && s.steps.length > 0) {
    stepsHtml = '<div class="steps-title">실행 단계</div><ul class="step-list">';
    s.steps.forEach((step, i) => {
      const action = step.action || '';
      const tagLabel = ACTION_LABELS[action] || action;
      const tagClass = ACTION_TAG_CLASS[action] || '';
      const stepType = STEP_TYPE[action] || 'action';
      const desc = step.description || '';

      stepsHtml += `
        <li class="step-item ${stepType}">
          <div class="step-dot">${i + 1}</div>
          <div class="step-content">
            <div class="step-desc">
              <span class="step-action-tag ${tagClass}">${tagLabel}</span>
              ${desc}
            </div>
          </div>
        </li>`;
    });
    stepsHtml += '</ul>';
  }

  let varsHtml = '';
  if (s.variables && s.variables.length > 0) {
    varsHtml = '<div class="variables"><div class="variables-title">필요 변수</div>';
    s.variables.forEach(v => {
      const def = s.defaults && s.defaults[v] ? ` = ${s.defaults[v]}` : '';
      varsHtml += `<span class="var-chip">{{${v}}}${def}</span>`;
    });
    varsHtml += '</div>';
  }

  return `
    <div class="card">
      <div class="card-header">
        <span class="card-arrow">&#9654;</span>
        ${typeBadge}
        ${catBadge}
        ${authBadge}
        <span class="card-title">${s.name}</span>
        <span class="card-step-count">${stepCount}단계</span>
      </div>
      <div class="card-body">
        ${s.precondition ? `<div class="precondition"><span class="precondition-icon">&#9888;</span><span><span class="precondition-label">전제조건:</span>${s.precondition}</span></div>` : ''}
        <div class="card-desc">${s.description || ''}</div>
        ${stepsHtml}
        ${varsHtml}
      </div>
    </div>`;
}

load();
</script>

</body>
</html>
